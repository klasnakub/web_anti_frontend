<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steam Guard Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --dark-bg: #1a1a2e;
      --card-bg: rgba(255, 255, 255, 0.95);
      --sidebar-bg: rgba(26, 26, 46, 0.95);
    }
    
    body {
      background: var(--primary-gradient);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .sidebar {
      background: linear-gradient(rgba(26, 26, 46, 0.8), rgba(26, 26, 46, 0.8)), url('backgroud2.jpg');
      background-size: cover;
      background-position: center;
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .main-content {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      min-height: 100vh;
    }
    
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .btn-modern {
      border-radius: 25px;
      padding: 10px 25px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-modern:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .nav-link {
      border-radius: 10px;
      margin: 5px 0;
      transition: all 0.3s ease;
    }
    
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }
    
    .table {
      border-radius: 15px;
      overflow: hidden;
    }
    
    .table thead th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      font-weight: 600;
    }
    
    .status-badge {
      border-radius: 20px;
      padding: 5px 15px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .search-box {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 25px;
      border: none;
      padding: 12px 20px;
    }
    
    .search-box:focus {
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
    }
  </style>
</head>
<body>
  <div class="container-fluid p-0">
    <div class="row g-0">
      <!-- Modern Sidebar -->
      <div class="col-lg-2 col-md-3 sidebar d-none d-md-block" style="min-height: 100vh;">
        <div class="p-4 position-relative" style="min-height: 100vh;">
          <!-- Logo Section -->
          <div class="text-center mb-5">
            <div class="bg-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="bi bi-display-fill text-primary fs-3"></i>
            </div>
            <h5 class="text-white fw-bold mb-0">Steam Guard</h5>
            <small class="text-white-50">Dashboard v0.1</small>
          </div>
          
          <!-- Navigation -->
          <nav class="nav flex-column">
            <a class="nav-link active text-white d-flex align-items-center" href="index.html">
              <i class="bi bi-speedometer2 me-3"></i>
              <span>Dashboard</span>
            </a>
            <a class="nav-link text-white-50 d-flex align-items-center" href="manage-leagues.html">
              <i class="bi bi-trophy me-3"></i>
              <span>Manage Leagues</span>
            </a>
            <a class="nav-link text-white-50 d-flex align-items-center" href="manage-matches.html">
              <i class="bi bi-calendar-event me-3"></i>
              <span>Manage Matches</span>
            </a>
          </nav>
          
          <hr class="text-white-50 my-4">
          
          <!-- User Section -->
          <div class="text-center position-absolute bottom-0 start-0 end-0 p-4">
            <div class="bg-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px;">
              <i class="bi bi-person-fill text-primary"></i>
            </div>
            <div class="text-white-50 small" id="userDisplay">Admin User</div>
            <a href="#" class="nav-link text-white-50 small logout">
              <i class="bi bi-box-arrow-right me-1"></i>Logout
            </a>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="col-lg-10 col-md-9 main-content">
        <div class="p-4">


          <!-- Stats Cards -->
          <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card stat-card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="card-title text-white-50 mb-1">Website</h6>
                      <h3 class="mb-0 text-white fw-bold" id="websiteCount">0</h3>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <i class="bi bi-window-desktop text-primary fs-4"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card stat-card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="card-title text-white-50 mb-1">Social Media</h6>
                      <h3 class="mb-0 text-white fw-bold" id="socialMediaCount">0</h3>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <i class="bi bi-facebook text-primary fs-4"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card stat-card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="card-title text-white-50 mb-1">Online</h6>
                      <h3 class="mb-0 text-white fw-bold" id="onlineCount">0</h3>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <i class="bi bi-wifi text-primary fs-4"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-3">
              <div class="card stat-card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="card-title text-white-50 mb-1">Takedown</h6>
                      <h3 class="mb-0 text-white fw-bold" id="takedownCount">0</h3>
                    </div>
                    <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                      <i class="bi bi-shield-x text-primary fs-4"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Search and Filters -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-lg-4">
                  <label class="form-label fw-semibold">Search Streams</label>
                  <div class="input-group">
                    <span class="input-group-text bg-transparent border-0">
                      <i class="bi bi-search text-muted"></i>
                    </span>
                    <input type="text" class="form-control search-box" placeholder="Search by title, league, or match...">
                  </div>
                </div>
                <div class="col-lg-2">
                  <label class="form-label fw-semibold">League</label>
                  <select class="form-select">
                    <option selected>All Leagues</option>
                    <option>Premier League</option>
                    <option>La Liga</option>
                    <option>Bundesliga</option>
                  </select>
                </div>
                <div class="col-lg-2">
                  <label class="form-label fw-semibold">Status</label>
                  <select class="form-select">
                    <option selected>All Status</option>
                    <option>Active</option>
                    <option>Inactive</option>
                    <option>Pending</option>
                  </select>
                </div>
                <div class="col-lg-2">
                  <label class="form-label fw-semibold">Date Range</label>
                  <select class="form-select">
                    <option selected>Last 7 days</option>
                    <option>Last 30 days</option>
                    <option>Last 3 months</option>
                  </select>
                </div>
                <div class="col-lg-2">
                  <button class="btn btn-primary btn-modern w-100">
                    <i class="bi bi-funnel me-2"></i>Filter
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Streams Table -->
          <div class="card">
            <div class="card-header bg-transparent border-0">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0 fw-bold">
                  <i class="bi bi-collection-play me-2"></i>Recent Streams
                </h5>
                <div class="d-flex gap-2">
                  <button class="btn btn-light btn-modern" data-bs-toggle="modal" data-bs-target="#newUrlModal">
                    <i class="bi bi-plus-circle me-2"></i>New Url
                  </button>
                  <button class="btn btn-light btn-modern text-dark" onclick="exportToCSV()">
                    <i class="bi bi-download me-2"></i>Export
                  </button>
                  <button class="btn btn-warning btn-modern" onclick="testAPIConnection()">
                    <i class="bi bi-bug me-2"></i>Test API
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead>
                    <tr>
                      <th class="fw-semibold">ID</th>
                      <th class="fw-semibold">URL</th>
                      <th class="fw-semibold">Type</th>
                      <th class="fw-semibold">Matches</th>
                      <th class="fw-semibold">League</th>
                      <th class="fw-semibold">Date & Time</th>
                      <th class="fw-semibold">Status</th>
                      <th class="fw-semibold">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><span class="badge bg-light text-dark">1</span></td>
                      <td>
                        <a href="#" class="text-decoration-none">https://example.com/stream1</a>
                      </td>
                      <td><span class="badge bg-danger" style="min-width: 100px;">Website</span></td>
                      <td>
                        <div class="fw-semibold">Man City vs Arsenal</div>
                      </td>
                      <td>Premier League</td>
                      <td>15 Jan 2024, 20:00</td>
                      <td><span class="badge bg-success text-white" style="min-width: 100px;">Active</span></td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <button class="btn btn-outline-primary" onclick="viewStreamDetails(this)">
                            <i class="bi bi-eye"></i>
                          </button>
                          <button class="btn btn-outline-secondary">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-light text-dark">2</span></td>
                      <td>
                        <a href="#" class="text-decoration-none">https://facebook.com/live/stream2</a>
                      </td>
                      <td><span class="badge bg-primary" style="min-width: 100px;">Social Media</span></td>
                      <td>
                        <div class="fw-semibold">Barcelona vs Real Madrid</div>
                      </td>
                      <td>La Liga</td>
                      <td>16 Jan 2024, 21:00</td>
                      <td><span class="badge bg-warning text-dark" style="min-width: 100px;">Pending</span></td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <button class="btn btn-outline-primary" onclick="viewStreamDetails(this)">
                            <i class="bi bi-eye"></i>
                          </button>
                          <button class="btn btn-outline-secondary">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td><span class="badge bg-light text-dark">3</span></td>
                      <td>
                        <a href="#" class="text-decoration-none">https://youtube.com/watch/stream3</a>
                      </td>
                      <td><span class="badge bg-primary" style="min-width: 100px;">Social Media</span></td>
                      <td>
                        <div class="fw-semibold">Bayern vs Dortmund</div>
                      </td>
                      <td>Bundesliga</td>
                      <td>14 Jan 2024, 19:30</td>
                      <td><span class="badge bg-secondary text-white" style="min-width: 100px;">Inactive</span></td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <button class="btn btn-outline-primary" onclick="viewStreamDetails(this)">
                            <i class="bi bi-eye"></i>
                          </button>
                          <button class="btn btn-outline-secondary">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- New URL Modal -->
  <div class="modal fade" id="newUrlModal" tabindex="-1" aria-labelledby="newUrlModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="newUrlModalLabel">
            <i class="bi bi-plus-circle me-2"></i>Add New URL
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="newUrlForm">
            <div class="row g-3">
              <!-- URL with Check button -->
              <div class="col-12">
                <label for="urlAddress" class="form-label fw-semibold">URL</label>
                <div class="input-group">
                  <input type="url" class="form-control" id="urlAddress" name="urlAddress" placeholder="https://example.com" required>
                  <button class="btn btn-outline-primary" type="button" onclick="checkUrl()">
                    <i class="bi bi-check-circle me-1"></i>Check
                  </button>
                </div>
              </div>
              
              <!-- Type dropdown -->
              <div class="col-md-6">
                <label for="urlType" class="form-label fw-semibold">Type</label>
                <select class="form-select" id="urlType" name="urlType" required>
                  <option value="">Select Type</option>
                  <option value="Website">Website</option>
                  <option value="Social Media">Social Media</option>
                </select>
              </div>
              
              <!-- League dropdown -->
              <div class="col-md-6">
                <label for="urlLeague" class="form-label fw-semibold">League</label>
                <select class="form-select" id="urlLeague" name="urlLeague" required>
                  <option value="">Select League</option>
                  <option value="Premier League">Premier League</option>
                  <option value="La Liga">La Liga</option>
                  <option value="Bundesliga">Bundesliga</option>
                  <option value="Serie A">Serie A</option>
                  <option value="Ligue 1">Ligue 1</option>
                </select>
              </div>
              
              <!-- Matches dropdown -->
              <div class="col-md-6">
                <label for="urlMatches" class="form-label fw-semibold">Matches</label>
                <select class="form-select" id="urlMatches" name="urlMatches" required>
                  <option value="">Select Match</option>
                  <option value="Man City vs Arsenal">Man City vs Arsenal</option>
                  <option value="Barcelona vs Real Madrid">Barcelona vs Real Madrid</option>
                  <option value="Bayern vs Dortmund">Bayern vs Dortmund</option>
                  <option value="Liverpool vs Chelsea">Liverpool vs Chelsea</option>
                  <option value="PSG vs Marseille">PSG vs Marseille</option>
                </select>
              </div>
              
              <!-- Status dropdown -->
              <div class="col-md-6">
                <label for="urlStatus" class="form-label fw-semibold">Status</label>
                <select class="form-select" id="urlStatus" name="urlStatus" required>
                  <option value="">Select Status</option>
                  <option value="Active">Active</option>
                  <option value="Takedown">Takedown</option>
                </select>
              </div>
              
              <!-- Image upload -->
              <div class="col-12">
                <label for="urlImage" class="form-label fw-semibold">Attach Image</label>
                <div class="input-group">
                  <input type="file" class="form-control" id="urlImage" name="urlImage" accept="image/*" onchange="previewImage(this)">
                  <button class="btn btn-outline-secondary" type="button" onclick="clearImage()">
                    <i class="bi bi-x-circle me-1"></i>Clear
                  </button>
                </div>
                <div id="imagePreview" class="mt-2" style="display: none;">
                  <img id="previewImg" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-2"></i>Cancel
          </button>
          <button type="button" class="btn btn-primary" onclick="addNewUrl()">
            <i class="bi bi-plus-circle me-2"></i>Add URL
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Stream Details Modal -->
  <div class="modal fade" id="viewStreamModal" tabindex="-1" aria-labelledby="viewStreamModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="viewStreamModalLabel">
            <i class="bi bi-eye me-2"></i>Stream Details
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">ID</label>
              <p class="form-control-plaintext" id="viewId">-</p>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Type</label>
              <p class="form-control-plaintext" id="viewType">-</p>
            </div>
            <div class="col-12">
              <label class="form-label fw-bold">URL</label>
              <p class="form-control-plaintext" id="viewUrl">-</p>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">League</label>
              <p class="form-control-plaintext" id="viewLeague">-</p>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Matches</label>
              <p class="form-control-plaintext" id="viewMatches">-</p>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Date & Time</label>
              <p class="form-control-plaintext" id="viewDateTime">-</p>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Status</label>
              <p class="form-control-plaintext" id="viewStatus">-</p>
            </div>
            <div class="col-12">
              <label class="form-label fw-bold">Image</label>
              <div class="text-center">
                <img id="viewImage" src="demo.webp" class="img-fluid rounded" style="max-width: 400px; max-height: 300px;" alt="Stream Image">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-2"></i>Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Auth Utility -->
  <script src="auth.js"></script>
  
  <script>
    // --- Auth check ---
    if (!validateAuth()) {
      // validateAuth() will handle the redirect
      // This prevents the rest of the script from executing
      throw new Error('Authentication failed');
    }

    // Logout handler
    const logoutBtn = document.querySelector('.logout');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function(e) {
        e.preventDefault();
        logout();
      });
    }

    // Update counts when page loads
    document.addEventListener('DOMContentLoaded', function() {
      updateTypeCounts();
      
      // Set up periodic token validation (check every 5 minutes)
      setInterval(() => {
        if (!validateAuth()) {
          console.log('Token validation failed during periodic check');
        }
      }, 5 * 60 * 1000); // 5 minutes
      
      // Display token information for debugging (remove in production)
      displayTokenInfo();
      
      // Debug token for troubleshooting
      debugToken();
      
      // Test API connection
      testAPIConnection();
    });
    


    // Function to check URL validity
    function checkUrl() {
      const urlInput = document.getElementById('urlAddress');
      const url = urlInput.value.trim();
      
      if (!url) {
        alert('Please enter a URL to check');
        return;
      }
      
      // Validate URL format
      try {
        new URL(url);
        
        // Show success message
        const checkButton = urlInput.nextElementSibling;
        const originalText = checkButton.innerHTML;
        checkButton.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i>Valid';
        checkButton.className = 'btn btn-success';
        
        // Reset button after 2 seconds
        setTimeout(() => {
          checkButton.innerHTML = originalText;
          checkButton.className = 'btn btn-outline-primary';
        }, 2000);
        
      } catch (error) {
        // Show error message
        const checkButton = urlInput.nextElementSibling;
        const originalText = checkButton.innerHTML;
        checkButton.innerHTML = '<i class="bi bi-x-circle me-1"></i>Invalid';
        checkButton.className = 'btn btn-danger';
        
        // Reset button after 2 seconds
        setTimeout(() => {
          checkButton.innerHTML = originalText;
          checkButton.className = 'btn btn-outline-primary';
        }, 2000);
        
        alert('Please enter a valid URL format (e.g., https://example.com)');
      }
    }

    // Function to preview selected image
    function previewImage(input) {
      const preview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          previewImg.src = e.target.result;
          preview.style.display = 'block';
        };
        
        reader.readAsDataURL(input.files[0]);
      } else {
        preview.style.display = 'none';
      }
    }

    // Function to clear selected image
    function clearImage() {
      const imageInput = document.getElementById('urlImage');
      const preview = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImg');
      
      imageInput.value = '';
      preview.style.display = 'none';
      previewImg.src = '';
    }

    // Function to view stream details
    function viewStreamDetails(button) {
      const row = button.closest('tr');
      const cells = row.querySelectorAll('td');
      
      // Extract data from table row
      const id = cells[0].querySelector('.badge').textContent.trim();
      const url = cells[1].querySelector('a').textContent.trim();
      const type = cells[2].querySelector('.badge').textContent.trim();
      const matches = cells[3].querySelector('.fw-semibold').textContent.trim();
      const league = cells[4].textContent.trim();
      const dateTime = cells[5].textContent.trim();
      const status = cells[6].querySelector('.badge').textContent.trim();
      
      // Populate modal with data
      document.getElementById('viewId').textContent = id;
      document.getElementById('viewUrl').textContent = url;
      document.getElementById('viewType').textContent = type;
      document.getElementById('viewMatches').textContent = matches;
      document.getElementById('viewLeague').textContent = league;
      document.getElementById('viewDateTime').textContent = dateTime;
      document.getElementById('viewStatus').textContent = status;
      
      // Set image (using demo.webp for now)
      const viewImage = document.getElementById('viewImage');
      viewImage.src = 'demo.webp';
      viewImage.alt = `Stream Image - ${matches}`;
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('viewStreamModal'));
      modal.show();
    }

    async function addNewUrl() {
      const form = document.getElementById('newUrlForm');
      const formData = new FormData(form);
      
      // Get form values
      const urlAddress = formData.get('urlAddress');
      const urlType = formData.get('urlType');
      const urlLeague = formData.get('urlLeague');
      const urlMatches = formData.get('urlMatches');
      const urlStatus = formData.get('urlStatus');
      
      // Get image file
      const imageFile = document.getElementById('urlImage').files[0];
      
      // Validate form
      if (!urlAddress || !urlType || !urlLeague || !urlMatches || !urlStatus) {
        alert('Please fill in all required fields');
        return;
      }
      
      // Validate URL format
      try {
        new URL(urlAddress);
      } catch (error) {
        alert('Please enter a valid URL');
        return;
      }
      
      try {
        // Prepare data for API call
        const urlData = {
          address: urlAddress,
          type: urlType,
          league: urlLeague,
          matches: urlMatches,
          status: urlStatus
        };
        
        // If you have a backend API endpoint, uncomment and modify this section:
        /*
        const response = await makeAuthenticatedRequest('https://your-api-endpoint.com/urls', {
          method: 'POST',
          body: JSON.stringify(urlData)
        });
        
        if (response.ok) {
          const result = await response.json();
          alert('URL added successfully!');
        } else {
          const errorData = await response.json();
          alert(`Failed to add URL: ${errorData.detail || 'Unknown error'}`);
          return;
        }
        */
        
        // For now, show success message (demo mode)
        alert('URL added successfully! (Note: This is a demo - no actual data was saved)');
        
        // Log the data to console
        console.log('New URL Data:', {
          address: urlAddress,
          type: urlType,
          league: urlLeague,
          matches: urlMatches,
          status: urlStatus,
          image: imageFile ? imageFile.name : 'No image selected'
        });
        
      } catch (error) {
        console.error('Error adding URL:', error);
        alert('Failed to add URL. Please try again.');
        return;
      }
      
      // Reset form and close modal
      form.reset();
      clearImage(); // Clear image preview
      const modal = bootstrap.Modal.getInstance(document.getElementById('newUrlModal'));
      modal.hide();
      
      // Update the type counts after adding new URL
      updateTypeCounts();
    }

    // Function to count types and status in table
    function updateTypeCounts() {
      const table = document.querySelector('table');
      if (!table) return;

      let websiteCount = 0;
      let socialMediaCount = 0;
      let onlineCount = 0;
      let takedownCount = 0;

      // Get all table rows
      const tableRows = table.querySelectorAll('tbody tr');
      
      tableRows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length >= 7) { // Make sure we have enough cells for both type and status
          // Count Type (3rd column, index 2)
          const typeCell = cells[2];
          if (typeCell.querySelector('.badge')) {
            const typeText = typeCell.querySelector('.badge').textContent.trim();
            
            if (typeText === 'Website') {
              websiteCount++;
            } else if (typeText === 'Social Media') {
              socialMediaCount++;
            }
          }
          
          // Count Status (7th column, index 6)
          const statusCell = cells[6];
          if (statusCell.querySelector('.badge')) {
            const statusText = statusCell.querySelector('.badge').textContent.trim();
            
            if (statusText === 'Inactive') {
              takedownCount++;
            } else {
              // Count all other statuses (Active, Pending, etc.) as Online
              onlineCount++;
            }
          }
        }
      });

      // Update the display
      document.getElementById('websiteCount').textContent = websiteCount;
      document.getElementById('socialMediaCount').textContent = socialMediaCount;
      document.getElementById('onlineCount').textContent = onlineCount;
      document.getElementById('takedownCount').textContent = takedownCount;
    }

    // Function to export table data to CSV
    function exportToCSV() {
      // Check authentication before proceeding
      if (!validateAuth()) {
        return;
      }
      
      const table = document.querySelector('table');
      if (!table) {
        alert('No table found to export');
        return;
      }

      // Get table headers
      const headers = [];
      const headerCells = table.querySelectorAll('thead th');
      headerCells.forEach(cell => {
        headers.push(cell.textContent.trim());
      });

      // Get table rows data
      const rows = [];
      const tableRows = table.querySelectorAll('tbody tr');
      
      tableRows.forEach(row => {
        const rowData = [];
        const cells = row.querySelectorAll('td');
        
        cells.forEach((cell, index) => {
          let cellText = '';
          
          // Handle different types of content in cells
          if (cell.querySelector('a')) {
            // If cell contains a link, get the link text
            cellText = cell.querySelector('a').textContent.trim();
          } else if (cell.querySelector('.badge')) {
            // If cell contains a badge, get the badge text
            cellText = cell.querySelector('.badge').textContent.trim();
          } else if (cell.querySelector('.fw-semibold')) {
            // If cell contains text with fw-semibold class
            cellText = cell.querySelector('.fw-semibold').textContent.trim();
          } else {
            // Regular text content
            cellText = cell.textContent.trim();
          }
          
          // Skip action buttons column (last column)
          if (index < cells.length - 1) {
            rowData.push(cellText);
          }
        });
        
        rows.push(rowData);
      });

      // Create CSV content
      let csvContent = '';
      
      // Add headers
      csvContent += headers.slice(0, -1).map(header => `"${header}"`).join(',') + '\n';
      
      // Add data rows
      rows.forEach(row => {
        csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
      });

      // Create and download file
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `streams_data_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        // Fallback for older browsers
        alert('Your browser does not support automatic download. Please copy the data manually.');
        console.log('CSV Data:', csvContent);
      }
    }
  </script>
</body>
</html> 